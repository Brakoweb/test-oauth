{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///Users/brako/Documents/proyectos/test/test%20oauth/constants/server/index.js"],"sourcesContent":["import qs from \"qs\";\n\nconst GHL_BASE={\n    OAUTH: 'https://marketplace.gohighlevel.com/oauth',\n    BASE: 'https://services.leadconnectorhq.com',\n    VERSION: '2021-07-28',\n    USER_TYPE: 'Company'\n}\n\nconst GHL_API={\n    authorize:({config})=>`${GHL_BASE.OAUTH}/chooselocation?${qs.stringify(config)}`,\n    token: `${GHL_BASE.BASE}/oauth/token`,\n    redirect_uri: `${process.env.HOST}/${process.env.GHL_OAUTH_REDIRECT_URI}`\n    \n}\n\nexport {\n    GHL_BASE,\n    GHL_API\n}"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,WAAS;IACX,OAAO;IACP,MAAM;IACN,SAAS;IACT,WAAW;AACf;AAEA,MAAM,UAAQ;IACV,WAAU,CAAC,EAAC,MAAM,EAAC,GAAG,GAAG,SAAS,KAAK,CAAC,gBAAgB,EAAE,+IAAE,CAAC,SAAS,CAAC,SAAS;IAChF,OAAO,GAAG,SAAS,IAAI,CAAC,YAAY,CAAC;IACrC,cAAc,GAAG,QAAQ,GAAG,CAAC,IAAI,CAAC,CAAC,EAAE,QAAQ,GAAG,CAAC,sBAAsB,EAAE;AAE7E"}},
    {"offset": {"line": 142, "column": 0}, "map": {"version":3,"sources":["file:///Users/brako/Documents/proyectos/test/test%20oauth/services/GHL/OAuth/index.js"],"sourcesContent":["import { headers } from \"next/headers.js\";\nimport axios from \"axios\";\nimport { GHL_API, GHL_BASE } from \"../../../constants/server/index.js\";\n\nexport class GoHighLevelOAuthService {\n    static authorize(){\n        return GHL_API.authorize({\n            config: {\n                client_id: process.env.GHL_CLIENT_ID,\n                redirect_uri: GHL_API.redirect_uri,\n                response_type: 'code',\n                scope: process.env.GHL_OAUTH_SCOPES\n            }\n});\n    }\n\n    static async redirect({code}){\n        try{\n            const payload={\n                code,\n                client_id: process.env.GHL_CLIENT_ID,\n                client_secret: process.env.GHL_CLIENT_SECRET,\n                redirect_uri: GHL_API.redirect_uri,\n                grant_type: 'authorization_code',\n                user_type: GHL_BASE.USER_TYPE\n            }\n            const {data, status}=await axios.post(GHL_API.token,payload,{\n                headers:{\n                    'Content-Type': 'application/x-www-form-urlencoded'\n                }\n            });\n            return data;\n        }catch(error){\n           console.log(`--GHL OAuth redirect failed, reason: ${error?.message}`); \n        }\n    }\n\n    static async getContacts({ accessToken, locationId }) {\n        try {\n            console.log('--GHL fetching contacts for locationId:', locationId);\n            \n            const { data } = await axios.post(\n                `${GHL_BASE.BASE}/contacts/search`,\n                {\n                    locationId: locationId,\n                    pageLimit: 100\n                },\n                {\n                    headers: {\n                        'Authorization': `Bearer ${accessToken}`,\n                        'Version': GHL_BASE.VERSION,\n                        'Content-Type': 'application/json',\n                    },\n                }\n            );\n            console.log('--GHL get contacts success, count:', data.contacts?.length || 0);\n            return data.contacts || [];\n        } catch (error) {\n            console.log(`--GHL get contacts failed, reason: ${error?.message}`);\n            if (error.response) {\n                console.log('Response status:', error.response.status);\n                console.log('Response data:', JSON.stringify(error.response.data));\n            }\n            return [];\n        }\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,MAAM;IACT,OAAO,YAAW;QACd,OAAO,yIAAO,CAAC,SAAS,CAAC;YACrB,QAAQ;gBACJ,WAAW,QAAQ,GAAG,CAAC,aAAa;gBACpC,cAAc,yIAAO,CAAC,YAAY;gBAClC,eAAe;gBACf,OAAO,QAAQ,GAAG,CAAC,gBAAgB;YACvC;QACZ;IACI;IAEA,aAAa,SAAS,EAAC,IAAI,EAAC,EAAC;QACzB,IAAG;YACC,MAAM,UAAQ;gBACV;gBACA,WAAW,QAAQ,GAAG,CAAC,aAAa;gBACpC,eAAe,QAAQ,GAAG,CAAC,iBAAiB;gBAC5C,cAAc,yIAAO,CAAC,YAAY;gBAClC,YAAY;gBACZ,WAAW,0IAAQ,CAAC,SAAS;YACjC;YACA,MAAM,EAAC,IAAI,EAAE,MAAM,EAAC,GAAC,MAAM,kJAAK,CAAC,IAAI,CAAC,yIAAO,CAAC,KAAK,EAAC,SAAQ;gBACxD,SAAQ;oBACJ,gBAAgB;gBACpB;YACJ;YACA,OAAO;QACX,EAAC,OAAM,OAAM;YACV,QAAQ,GAAG,CAAC,CAAC,qCAAqC,EAAE,OAAO,SAAS;QACvE;IACJ;IAEA,aAAa,YAAY,EAAE,WAAW,EAAE,UAAU,EAAE,EAAE;QAClD,IAAI;YACA,QAAQ,GAAG,CAAC,2CAA2C;YAEvD,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,kJAAK,CAAC,IAAI,CAC7B,GAAG,0IAAQ,CAAC,IAAI,CAAC,gBAAgB,CAAC,EAClC;gBACI,YAAY;gBACZ,WAAW;YACf,GACA;gBACI,SAAS;oBACL,iBAAiB,CAAC,OAAO,EAAE,aAAa;oBACxC,WAAW,0IAAQ,CAAC,OAAO;oBAC3B,gBAAgB;gBACpB;YACJ;YAEJ,QAAQ,GAAG,CAAC,sCAAsC,KAAK,QAAQ,EAAE,UAAU;YAC3E,OAAO,KAAK,QAAQ,IAAI,EAAE;QAC9B,EAAE,OAAO,OAAO;YACZ,QAAQ,GAAG,CAAC,CAAC,mCAAmC,EAAE,OAAO,SAAS;YAClE,IAAI,MAAM,QAAQ,EAAE;gBAChB,QAAQ,GAAG,CAAC,oBAAoB,MAAM,QAAQ,CAAC,MAAM;gBACrD,QAAQ,GAAG,CAAC,kBAAkB,KAAK,SAAS,CAAC,MAAM,QAAQ,CAAC,IAAI;YACpE;YACA,OAAO,EAAE;QACb;IACJ;AACJ"}},
    {"offset": {"line": 212, "column": 0}, "map": {"version":3,"sources":["file:///Users/brako/Documents/proyectos/test/test%20oauth/lib/session.js"],"sourcesContent":["import { SignJWT, jwtVerify } from 'jose';\nimport { cookies } from 'next/headers';\n\nconst secret = new TextEncoder().encode(process.env.SESSION_SECRET);\nconst COOKIE_NAME = 'ghl_session';\n\nexport async function setSession(data) {\n  console.log('setSession - Data to save:', data);\n  \n  const token = await new SignJWT(data)\n    .setProtectedHeader({ alg: 'HS256' })\n    .setExpirationTime('7d')\n    .sign(secret);\n\n  console.log('setSession - Token created:', token ? 'yes' : 'no');\n\n  const cookieStore = await cookies();\n  cookieStore.set(COOKIE_NAME, token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax',\n    maxAge: 60 * 60 * 24 * 7, // 7 days\n    path: '/',\n  });\n  \n  console.log('setSession - Cookie set with name:', COOKIE_NAME);\n  return token;\n}\n\nexport async function getSession() {\n  const cookieStore = await cookies();\n  const token = cookieStore.get(COOKIE_NAME)?.value;\n  console.log('getSession - Token from cookie:', token ? 'present' : 'missing');\n\n  if (!token) return null;\n\n  try {\n    const { payload } = await jwtVerify(token, secret);\n    console.log('getSession - Payload:', payload);\n    return payload;\n  } catch (error) {\n    console.log('getSession - Error verifying token:', error.message);\n    return null;\n  }\n}\n\nexport async function clearSession() {\n  const cookieStore = await cookies();\n  cookieStore.delete(COOKIE_NAME);\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;AACA;;;AAEA,MAAM,SAAS,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,cAAc;AAClE,MAAM,cAAc;AAEb,eAAe,WAAW,IAAI;IACnC,QAAQ,GAAG,CAAC,8BAA8B;IAE1C,MAAM,QAAQ,MAAM,IAAI,kKAAO,CAAC,MAC7B,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,iBAAiB,CAAC,MAClB,IAAI,CAAC;IAER,QAAQ,GAAG,CAAC,+BAA+B,QAAQ,QAAQ;IAE3D,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,YAAY,GAAG,CAAC,aAAa,OAAO;QAClC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,KAAK,KAAK,KAAK;QACvB,MAAM;IACR;IAEA,QAAQ,GAAG,CAAC,sCAAsC;IAClD,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,cAAc;IAC5C,QAAQ,GAAG,CAAC,mCAAmC,QAAQ,YAAY;IAEnE,IAAI,CAAC,OAAO,OAAO;IAEnB,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;QAC3C,QAAQ,GAAG,CAAC,yBAAyB;QACrC,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,GAAG,CAAC,uCAAuC,MAAM,OAAO;QAChE,OAAO;IACT;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,YAAY,MAAM,CAAC;AACrB"}},
    {"offset": {"line": 266, "column": 0}, "map": {"version":3,"sources":["file:///Users/brako/Documents/proyectos/test/test%20oauth/src/app/api/v2/%5Baction%5D/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { GoHighLevelOAuthService } from \"../../../../../services/GHL/OAuth/index.js\";\nimport { setSession } from '../../../../../lib/session.js';\n\nexport async function GET(request, context) {\n    try{\n        const { action } = await context.params;\n        switch(action){\n            case 'authorize':\n                return NextResponse.redirect(GoHighLevelOAuthService.authorize());\n            case 'redirect':\n                                const { code } = Object.fromEntries(request.nextUrl.searchParams);\n                if(!code){\n                    return NextResponse.redirect(process.env.GHL_OAUTH_FAIL);\n                }\n\n                const tokenData = await GoHighLevelOAuthService.redirect({code});\n                console.log('Token data received:', tokenData);\n                \n                if (!tokenData || !tokenData.access_token) {\n                    console.log('No token data, redirecting to fail');\n                    return NextResponse.redirect(process.env.GHL_OAUTH_FAIL);\n                }\n\n                console.log('Saving session with:', {\n                    accessToken: tokenData.access_token ? 'present' : 'missing',\n                    locationId: tokenData.locationId\n                });\n\n                const token = await setSession({\n                    accessToken: tokenData.access_token,\n                    locationId: tokenData.locationId\n                });\n                \n                console.log('Session saved, redirecting to auth-success page');\n                \n                // Redirect to intermediate page that will then redirect to dashboard\n                const successUrl = `${process.env.HOST}/auth-success?redirect=/dashboard`;\n                \n                const response = NextResponse.redirect(successUrl);\n                response.cookies.set('ghl_session', token, {\n                    httpOnly: true,\n                    secure: process.env.NODE_ENV === 'production',\n                    sameSite: 'lax',\n                    maxAge: 60 * 60 * 24 * 7,\n                    path: '/',\n                });\n                \n                console.log('Cookie set on response, redirecting to:', successUrl);\n                return response;    \n        }\n        return NextResponse.json({message: 'Accion invalida'}, {status: 400})\n    }catch(error){\n        return NextResponse.json({error: error.message}, {status: 500})\n    }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,OAAO,EAAE,OAAO;IACtC,IAAG;QACC,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,QAAQ,MAAM;QACvC,OAAO;YACH,KAAK;gBACD,OAAO,gJAAY,CAAC,QAAQ,CAAC,8JAAuB,CAAC,SAAS;YAClE,KAAK;gBACe,MAAM,EAAE,IAAI,EAAE,GAAG,OAAO,WAAW,CAAC,QAAQ,OAAO,CAAC,YAAY;gBAChF,IAAG,CAAC,MAAK;oBACL,OAAO,gJAAY,CAAC,QAAQ,CAAC,QAAQ,GAAG,CAAC,cAAc;gBAC3D;gBAEA,MAAM,YAAY,MAAM,8JAAuB,CAAC,QAAQ,CAAC;oBAAC;gBAAI;gBAC9D,QAAQ,GAAG,CAAC,wBAAwB;gBAEpC,IAAI,CAAC,aAAa,CAAC,UAAU,YAAY,EAAE;oBACvC,QAAQ,GAAG,CAAC;oBACZ,OAAO,gJAAY,CAAC,QAAQ,CAAC,QAAQ,GAAG,CAAC,cAAc;gBAC3D;gBAEA,QAAQ,GAAG,CAAC,wBAAwB;oBAChC,aAAa,UAAU,YAAY,GAAG,YAAY;oBAClD,YAAY,UAAU,UAAU;gBACpC;gBAEA,MAAM,QAAQ,MAAM,IAAA,8HAAU,EAAC;oBAC3B,aAAa,UAAU,YAAY;oBACnC,YAAY,UAAU,UAAU;gBACpC;gBAEA,QAAQ,GAAG,CAAC;gBAEZ,qEAAqE;gBACrE,MAAM,aAAa,GAAG,QAAQ,GAAG,CAAC,IAAI,CAAC,iCAAiC,CAAC;gBAEzE,MAAM,WAAW,gJAAY,CAAC,QAAQ,CAAC;gBACvC,SAAS,OAAO,CAAC,GAAG,CAAC,eAAe,OAAO;oBACvC,UAAU;oBACV,QAAQ,oDAAyB;oBACjC,UAAU;oBACV,QAAQ,KAAK,KAAK,KAAK;oBACvB,MAAM;gBACV;gBAEA,QAAQ,GAAG,CAAC,2CAA2C;gBACvD,OAAO;QACf;QACA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAC,SAAS;QAAiB,GAAG;YAAC,QAAQ;QAAG;IACvE,EAAC,OAAM,OAAM;QACT,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAC,OAAO,MAAM,OAAO;QAAA,GAAG;YAAC,QAAQ;QAAG;IACjE;AACJ"}}]
}