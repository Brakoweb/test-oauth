{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 14, "column": 0}, "map": {"version":3,"sources":["file:///Users/brako/Documents/proyectos/test/test%20oauth/lib/session.js"],"sourcesContent":["import { SignJWT, jwtVerify } from 'jose';\nimport { cookies } from 'next/headers';\n\nconst secret = new TextEncoder().encode(process.env.SESSION_SECRET);\nconst COOKIE_NAME = 'ghl_session';\n\nexport async function setSession(data) {\n  console.log('setSession - Data to save:', data);\n  \n  const token = await new SignJWT(data)\n    .setProtectedHeader({ alg: 'HS256' })\n    .setExpirationTime('7d')\n    .sign(secret);\n\n  console.log('setSession - Token created:', token ? 'yes' : 'no');\n\n  const cookieStore = await cookies();\n  cookieStore.set(COOKIE_NAME, token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax',\n    maxAge: 60 * 60 * 24 * 7, // 7 days\n    path: '/',\n  });\n  \n  console.log('setSession - Cookie set with name:', COOKIE_NAME);\n  return token;\n}\n\nexport async function getSession() {\n  const cookieStore = await cookies();\n  const token = cookieStore.get(COOKIE_NAME)?.value;\n  console.log('getSession - Token from cookie:', token ? 'present' : 'missing');\n\n  if (!token) return null;\n\n  try {\n    const { payload } = await jwtVerify(token, secret);\n    console.log('getSession - Payload:', payload);\n    return payload;\n  } catch (error) {\n    console.log('getSession - Error verifying token:', error.message);\n    return null;\n  }\n}\n\nexport async function clearSession() {\n  const cookieStore = await cookies();\n  cookieStore.delete(COOKIE_NAME);\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;AACA;;;AAEA,MAAM,SAAS,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,cAAc;AAClE,MAAM,cAAc;AAEb,eAAe,WAAW,IAAI;IACnC,QAAQ,GAAG,CAAC,8BAA8B;IAE1C,MAAM,QAAQ,MAAM,IAAI,gKAAO,CAAC,MAC7B,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,iBAAiB,CAAC,MAClB,IAAI,CAAC;IAER,QAAQ,GAAG,CAAC,+BAA+B,QAAQ,QAAQ;IAE3D,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,YAAY,GAAG,CAAC,aAAa,OAAO;QAClC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,KAAK,KAAK,KAAK;QACvB,MAAM;IACR;IAEA,QAAQ,GAAG,CAAC,sCAAsC;IAClD,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,cAAc;IAC5C,QAAQ,GAAG,CAAC,mCAAmC,QAAQ,YAAY;IAEnE,IAAI,CAAC,OAAO,OAAO;IAEnB,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,oKAAS,EAAC,OAAO;QAC3C,QAAQ,GAAG,CAAC,yBAAyB;QACrC,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,GAAG,CAAC,uCAAuC,MAAM,OAAO;QAChE,OAAO;IACT;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,YAAY,MAAM,CAAC;AACrB"}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///Users/brako/Documents/proyectos/test/test%20oauth/constants/server/index.js"],"sourcesContent":["import qs from \"qs\";\n\nconst GHL_BASE={\n    OAUTH: 'https://marketplace.gohighlevel.com/oauth',\n    BASE: 'https://services.leadconnectorhq.com',\n    VERSION: '2021-07-28',\n    USER_TYPE: 'Company'\n}\n\nconst GHL_API={\n    authorize:({config})=>`${GHL_BASE.OAUTH}/chooselocation?${qs.stringify(config)}`,\n    token: `${GHL_BASE.BASE}/oauth/token`,\n    redirect_uri: `${process.env.HOST}/${process.env.GHL_OAUTH_REDIRECT_URI}`\n    \n}\n\nexport {\n    GHL_BASE,\n    GHL_API\n}"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,WAAS;IACX,OAAO;IACP,MAAM;IACN,SAAS;IACT,WAAW;AACf;AAEA,MAAM,UAAQ;IACV,WAAU,CAAC,EAAC,MAAM,EAAC,GAAG,GAAG,SAAS,KAAK,CAAC,gBAAgB,EAAE,6IAAE,CAAC,SAAS,CAAC,SAAS;IAChF,OAAO,GAAG,SAAS,IAAI,CAAC,YAAY,CAAC;IACrC,cAAc,GAAG,QAAQ,GAAG,CAAC,IAAI,CAAC,CAAC,EAAE,QAAQ,GAAG,CAAC,sBAAsB,EAAE;AAE7E"}},
    {"offset": {"line": 152, "column": 0}, "map": {"version":3,"sources":["file:///Users/brako/Documents/proyectos/test/test%20oauth/services/GHL/OAuth/index.js"],"sourcesContent":["import { headers } from \"next/headers.js\";\nimport axios from \"axios\";\nimport { GHL_API, GHL_BASE } from \"../../../constants/server/index.js\";\n\nexport class GoHighLevelOAuthService {\n    static authorize(){\n        return GHL_API.authorize({\n            config: {\n                client_id: process.env.GHL_CLIENT_ID,\n                redirect_uri: GHL_API.redirect_uri,\n                response_type: 'code',\n                scope: process.env.GHL_OAUTH_SCOPES\n            }\n});\n    }\n\n    static async redirect({code}){\n        try{\n            const payload={\n                code,\n                client_id: process.env.GHL_CLIENT_ID,\n                client_secret: process.env.GHL_CLIENT_SECRET,\n                redirect_uri: GHL_API.redirect_uri,\n                grant_type: 'authorization_code',\n                user_type: GHL_BASE.USER_TYPE\n            }\n            const {data, status}=await axios.post(GHL_API.token,payload,{\n                headers:{\n                    'Content-Type': 'application/x-www-form-urlencoded'\n                }\n            });\n            return data;\n        }catch(error){\n           console.log(`--GHL OAuth redirect failed, reason: ${error?.message}`); \n        }\n    }\n\n    static async getContacts({ accessToken, locationId }) {\n        try {\n            console.log('--GHL fetching contacts for locationId:', locationId);\n            \n            const { data } = await axios.post(\n                `${GHL_BASE.BASE}/contacts/search`,\n                {\n                    locationId: locationId,\n                    pageLimit: 100\n                },\n                {\n                    headers: {\n                        'Authorization': `Bearer ${accessToken}`,\n                        'Version': GHL_BASE.VERSION,\n                        'Content-Type': 'application/json',\n                    },\n                }\n            );\n            console.log('--GHL get contacts success, count:', data.contacts?.length || 0);\n            return data.contacts || [];\n        } catch (error) {\n            console.log(`--GHL get contacts failed, reason: ${error?.message}`);\n            if (error.response) {\n                console.log('Response status:', error.response.status);\n                console.log('Response data:', JSON.stringify(error.response.data));\n            }\n            return [];\n        }\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,MAAM;IACT,OAAO,YAAW;QACd,OAAO,uIAAO,CAAC,SAAS,CAAC;YACrB,QAAQ;gBACJ,WAAW,QAAQ,GAAG,CAAC,aAAa;gBACpC,cAAc,uIAAO,CAAC,YAAY;gBAClC,eAAe;gBACf,OAAO,QAAQ,GAAG,CAAC,gBAAgB;YACvC;QACZ;IACI;IAEA,aAAa,SAAS,EAAC,IAAI,EAAC,EAAC;QACzB,IAAG;YACC,MAAM,UAAQ;gBACV;gBACA,WAAW,QAAQ,GAAG,CAAC,aAAa;gBACpC,eAAe,QAAQ,GAAG,CAAC,iBAAiB;gBAC5C,cAAc,uIAAO,CAAC,YAAY;gBAClC,YAAY;gBACZ,WAAW,wIAAQ,CAAC,SAAS;YACjC;YACA,MAAM,EAAC,IAAI,EAAE,MAAM,EAAC,GAAC,MAAM,gJAAK,CAAC,IAAI,CAAC,uIAAO,CAAC,KAAK,EAAC,SAAQ;gBACxD,SAAQ;oBACJ,gBAAgB;gBACpB;YACJ;YACA,OAAO;QACX,EAAC,OAAM,OAAM;YACV,QAAQ,GAAG,CAAC,CAAC,qCAAqC,EAAE,OAAO,SAAS;QACvE;IACJ;IAEA,aAAa,YAAY,EAAE,WAAW,EAAE,UAAU,EAAE,EAAE;QAClD,IAAI;YACA,QAAQ,GAAG,CAAC,2CAA2C;YAEvD,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,gJAAK,CAAC,IAAI,CAC7B,GAAG,wIAAQ,CAAC,IAAI,CAAC,gBAAgB,CAAC,EAClC;gBACI,YAAY;gBACZ,WAAW;YACf,GACA;gBACI,SAAS;oBACL,iBAAiB,CAAC,OAAO,EAAE,aAAa;oBACxC,WAAW,wIAAQ,CAAC,OAAO;oBAC3B,gBAAgB;gBACpB;YACJ;YAEJ,QAAQ,GAAG,CAAC,sCAAsC,KAAK,QAAQ,EAAE,UAAU;YAC3E,OAAO,KAAK,QAAQ,IAAI,EAAE;QAC9B,EAAE,OAAO,OAAO;YACZ,QAAQ,GAAG,CAAC,CAAC,mCAAmC,EAAE,OAAO,SAAS;YAClE,IAAI,MAAM,QAAQ,EAAE;gBAChB,QAAQ,GAAG,CAAC,oBAAoB,MAAM,QAAQ,CAAC,MAAM;gBACrD,QAAQ,GAAG,CAAC,kBAAkB,KAAK,SAAS,CAAC,MAAM,QAAQ,CAAC,IAAI;YACpE;YACA,OAAO,EAAE;QACb;IACJ;AACJ"}},
    {"offset": {"line": 222, "column": 0}, "map": {"version":3,"sources":["file:///Users/brako/Documents/proyectos/test/test%20oauth/src/app/dashboard/page.js"],"sourcesContent":["import { getSession } from '../../../lib/session.js';\nimport { GoHighLevelOAuthService } from '../../../services/GHL/OAuth/index.js';\n\nexport default async function DashboardPage() {\n  const session = await getSession();\n  console.log('Dashboard - Session retrieved:', session);\n\n  if (!session || !session.accessToken) {\n    console.log('Dashboard - No session or no access token');\n    return (\n      <div style={{ padding: '2rem', textAlign: 'center' }}>\n        <h1>No autenticado</h1>\n        <p>Por favor, inicia sesión primero.</p>\n        <a href=\"/api/v2/authorize\" style={{ color: 'blue', textDecoration: 'underline' }}>\n          Iniciar sesión\n        </a>\n      </div>\n    );\n  }\n\n  let contacts = [];\n  let error = null;\n\n  try {\n    contacts = await GoHighLevelOAuthService.getContacts({\n      accessToken: session.accessToken,\n      locationId: session.locationId\n    });\n  } catch (err) {\n    error = err.message;\n  }\n\n  return (\n    <div style={{ padding: '2rem', maxWidth: '1200px', margin: '0 auto' }}>\n      <h1 style={{ marginBottom: '2rem' }}>Dashboard de Contactos</h1>\n      \n      {error && (\n        <div style={{ backgroundColor: '#fee', padding: '1rem', borderRadius: '4px', marginBottom: '1rem' }}>\n          <p style={{ color: 'red' }}>Error: {error}</p>\n        </div>\n      )}\n\n      {contacts.length === 0 && !error ? (\n        <p>No se encontraron contactos.</p>\n      ) : (\n        <div style={{ overflowX: 'auto' }}>\n          <table style={{ width: '100%', borderCollapse: 'collapse', border: '1px solid #ddd' }}>\n            <thead>\n              <tr style={{ backgroundColor: '#f5f5f5' }}>\n                <th style={{ padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd' }}>Nombre</th>\n                <th style={{ padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd' }}>Email</th>\n                <th style={{ padding: '12px', textAlign: 'left', borderBottom: '2px solid #ddd' }}>Teléfono</th>\n              </tr>\n            </thead>\n            <tbody>\n              {contacts.map((contact, index) => (\n                <tr key={contact.id || index} style={{ borderBottom: '1px solid #eee' }}>\n                  <td style={{ padding: '12px' }}>\n                    {contact.firstName || ''} {contact.lastName || ''}\n                  </td>\n                  <td style={{ padding: '12px' }}>{contact.email || '-'}</td>\n                  <td style={{ padding: '12px' }}>{contact.phone || '-'}</td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n          <p style={{ marginTop: '1rem', color: '#666' }}>\n            Total de contactos: {contacts.length}\n          </p>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAEe,eAAe;IAC5B,MAAM,UAAU,MAAM,IAAA,4HAAU;IAChC,QAAQ,GAAG,CAAC,kCAAkC;IAE9C,IAAI,CAAC,WAAW,CAAC,QAAQ,WAAW,EAAE;QACpC,QAAQ,GAAG,CAAC;QACZ,qBACE,8OAAC;YAAI,OAAO;gBAAE,SAAS;gBAAQ,WAAW;YAAS;;8BACjD,8OAAC;8BAAG;;;;;;8BACJ,8OAAC;8BAAE;;;;;;8BACH,8OAAC;oBAAE,MAAK;oBAAoB,OAAO;wBAAE,OAAO;wBAAQ,gBAAgB;oBAAY;8BAAG;;;;;;;;;;;;IAKzF;IAEA,IAAI,WAAW,EAAE;IACjB,IAAI,QAAQ;IAEZ,IAAI;QACF,WAAW,MAAM,4JAAuB,CAAC,WAAW,CAAC;YACnD,aAAa,QAAQ,WAAW;YAChC,YAAY,QAAQ,UAAU;QAChC;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,IAAI,OAAO;IACrB;IAEA,qBACE,8OAAC;QAAI,OAAO;YAAE,SAAS;YAAQ,UAAU;YAAU,QAAQ;QAAS;;0BAClE,8OAAC;gBAAG,OAAO;oBAAE,cAAc;gBAAO;0BAAG;;;;;;YAEpC,uBACC,8OAAC;gBAAI,OAAO;oBAAE,iBAAiB;oBAAQ,SAAS;oBAAQ,cAAc;oBAAO,cAAc;gBAAO;0BAChG,cAAA,8OAAC;oBAAE,OAAO;wBAAE,OAAO;oBAAM;;wBAAG;wBAAQ;;;;;;;;;;;;YAIvC,SAAS,MAAM,KAAK,KAAK,CAAC,sBACzB,8OAAC;0BAAE;;;;;qCAEH,8OAAC;gBAAI,OAAO;oBAAE,WAAW;gBAAO;;kCAC9B,8OAAC;wBAAM,OAAO;4BAAE,OAAO;4BAAQ,gBAAgB;4BAAY,QAAQ;wBAAiB;;0CAClF,8OAAC;0CACC,cAAA,8OAAC;oCAAG,OAAO;wCAAE,iBAAiB;oCAAU;;sDACtC,8OAAC;4CAAG,OAAO;gDAAE,SAAS;gDAAQ,WAAW;gDAAQ,cAAc;4CAAiB;sDAAG;;;;;;sDACnF,8OAAC;4CAAG,OAAO;gDAAE,SAAS;gDAAQ,WAAW;gDAAQ,cAAc;4CAAiB;sDAAG;;;;;;sDACnF,8OAAC;4CAAG,OAAO;gDAAE,SAAS;gDAAQ,WAAW;gDAAQ,cAAc;4CAAiB;sDAAG;;;;;;;;;;;;;;;;;0CAGvF,8OAAC;0CACE,SAAS,GAAG,CAAC,CAAC,SAAS,sBACtB,8OAAC;wCAA6B,OAAO;4CAAE,cAAc;wCAAiB;;0DACpE,8OAAC;gDAAG,OAAO;oDAAE,SAAS;gDAAO;;oDAC1B,QAAQ,SAAS,IAAI;oDAAG;oDAAE,QAAQ,QAAQ,IAAI;;;;;;;0DAEjD,8OAAC;gDAAG,OAAO;oDAAE,SAAS;gDAAO;0DAAI,QAAQ,KAAK,IAAI;;;;;;0DAClD,8OAAC;gDAAG,OAAO;oDAAE,SAAS;gDAAO;0DAAI,QAAQ,KAAK,IAAI;;;;;;;uCAL3C,QAAQ,EAAE,IAAI;;;;;;;;;;;;;;;;kCAU7B,8OAAC;wBAAE,OAAO;4BAAE,WAAW;4BAAQ,OAAO;wBAAO;;4BAAG;4BACzB,SAAS,MAAM;;;;;;;;;;;;;;;;;;;AAMhD"}}]
}